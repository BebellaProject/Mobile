/*! bebella 2016-07-03 */
function view(a){return"views/"+a+".html"}function api_v1(a,b){return APP_URL+"/api/v1/"+a+"?api_token="+b}function attr(a,b){for(var c in b)"created_at"==c||"updated_at"==c?a[c]=moment(b[c]).fromNow():c.startsWith("has_")||c.startsWith("is_")||c.startsWith("used_for_")?a[c]=1==b[c]:a[c]=b[c]}var Bebella=angular.module("Bebella",["ionic","angularMoment","ngStorage"]),APP_URL="http://localhost:8000";Bebella.run(["$ionicPlatform","amMoment","AuthUser","$state",function(a,b,c,d){b.changeLocale("pt-br"),a.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),c.get().then(function(a){d.go("tabs.home"),console.log(a)},function(a){d.go("login")})})}]),Bebella.factory("Channel",[function(){var a=new Function;return a}]),Bebella.factory("Recipe",[function(){var a=function(){this.tags=new Array,this.steps=new Array,this.products=new Array,this.comments=new Array,this.related=new Array};return a}]),Bebella.factory("User",[function(){var a=new Function;return a}]),Bebella.service("AuthUser",["$q","$localStorage",function(a,b){var c=this;c.get=function(){var c=a.defer(),d=b.auth_user;return d?c.resolve(d):c.reject("Usuário não salvo"),c.promise},c.set=function(a){b.auth_user=a}}]),Bebella.service("PingProvider",["$q","$http",function(a,b){var c=this;c.ping=function(){var c=a.defer();return b.get(APP_URL+"/ping").then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise}}]),Bebella.service("ChannelRepository",["$http","$q","Channel",function(a,b,c){var d=this;d.find=function(d){var e=b.defer();return a.get(api_v1("channel/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.all=function(){var d=b.defer();return a.get(api_v1("channel/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.edit=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("channel/edit"),e).then(function(a){d.resolve(c)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("channel/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("RecipeRepository",["$http","$q","Recipe",function(a,b,c){var d=this;d.find=function(d){var e=b.defer();return a.get(api_v1("recipe/find/"+d)).then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.all=function(){var d=b.defer();return a.get(api_v1("recipe/all")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.trending=function(){var d=b.defer();return a.get(api_v1("recipe/trending")).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});d.resolve(b)},function(a){d.reject(a)}),d.promise},d.edit=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("recipe/edit"),e).then(function(a){d.resolve(c)},function(a){d.reject(a)}),d.promise},d.save=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(api_v1("recipe/save"),e).then(function(a){c.id=a.data.id,d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.service("UserRepository",["$http","$q","User",function(a,b,c){var d=this;d.auth=function(d){var e=b.defer();return a.get(APP_URL+"/auth/user").then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.login=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(APP_URL+"/auth/api_login",e).then(function(a){attr(c,a.data),d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.controller("FilterIndexCtrl",["$scope",function(a){}]),Bebella.controller("IndexCtrl",["$scope","RecipeRepository",function(a,b){a.appUrl=APP_URL,b.all().then(function(b){a.recipes=b},function(a){alert("Houve um erro na obtenção da lista de receitas")})}]),Bebella.controller("LoginIndexCtrl",["$scope","$http","$state","AuthUser","User","PingProvider","UserRepository",function(a,b,c,d,e,f,g){a.user=new e,a.login=function(){f.ping().then(function(b){g.login(a.user).then(function(a){d.set(a),c.go("tabs.home")},function(a){alert("Login falhou, por favor, verifique as credenciais fornecidas.")})},function(a){alert("Não foi possivel estabelecer comunicação com o servidor.")})}}]),Bebella.controller("ProductOptionListCtrl",["$scope",function(a){}]),Bebella.controller("RecipeIndexCtrl",["$scope","$stateParams","RecipeRepository",function(a,b,c){a.appUrl=APP_URL,c.find(b.recipeId).then(function(b){a.recipe=b},function(a){alert("Erro ao obter os detalhes da receita")})}]),Bebella.controller("RegisterIndexCtrl",["$scope",function(a){}]),Bebella.controller("SubscriptionIndexCtrl",["$scope","ChannelRepository",function(a,b){a.appUrl=APP_URL,b.all().then(function(b){a.channels=b},function(a){alert("Houve um erro na obtenção da lista de canais")})}]),Bebella.controller("TabsCtrl",["$scope","$state",function(a,b){a.changeTab=function(a){b.go(a)}}]),Bebella.controller("TrendingIndexCtrl",["$scope","RecipeRepository",function(a,b){a.appUrl=APP_URL,b.trending().then(function(b){a.recipes=b},function(a){alert("Houve um erro na obtenção da lista de tendências")})}]),Bebella.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/tabs/home"),a.state("login",{url:"/login",templateUrl:view("login/index"),controller:"LoginIndexCtrl"}).state("register",{url:"/register",templateUrl:view("register/index"),controller:"RegisterIndexCtrl"}).state("tabs",{url:"/tabs",templateUrl:view("tabs"),controller:"TabsCtrl","abstract":!0}).state("tabs.home",{url:"/home",views:{tab1:{templateUrl:view("home/index"),controller:"IndexCtrl"}}}).state("tabs.trending",{url:"/trending",views:{tab2:{templateUrl:view("trending/index"),controller:"TrendingIndexCtrl"}}}).state("tabs.subscriptions",{url:"/subscriptions",views:{tab3:{templateUrl:view("subscription/index"),controller:"SubscriptionIndexCtrl"}}}).state("tabs.filter",{url:"/filter",views:{tab4:{templateUrl:view("filter/index"),controller:"FilterIndexCtrl"}}}).state("recipe",{url:"/recipe/{recipeId}",templateUrl:view("recipe/index"),controller:"RecipeIndexCtrl"}).state("product_option_list",{url:"/product/{productId}/options",templateUrl:view("product/option/list"),controller:"ProductOptionListCtrl"})}]);