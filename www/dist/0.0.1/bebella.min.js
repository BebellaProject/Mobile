/*! bebella 2016-07-07 */
function view(a){return"views/"+a+".html"}function api_v1(a,b){return APP_URL+"/api/v1/"+a+"?api_token="+b}function attr(a,b){for(var c in b)"created_at"==c||"updated_at"==c?a[c]=moment(b[c]).fromNow():c.startsWith("has_")||c.startsWith("is_")||c.startsWith("used_for_")?a[c]=1==b[c]:a[c]=b[c]}var Bebella=angular.module("Bebella",["ionic","angularMoment","ngStorage"]),APP_URL="http://localhost:8000";Bebella.run(["$ionicPlatform","amMoment","AuthUser","$state","FilterOptions",function(a,b,c,d,e){b.changeLocale("pt-br"),a.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),c.get().then(function(a){e.get().then(function(a){},function(a){e.setDefault()}),d.go("tabs.home")},function(a){d.go("login")})})}]),Bebella.factory("Channel",[function(){var a=new Function;return a}]),Bebella.factory("Product",[function(){var a=new Function;return a}]),Bebella.factory("ProductOption",[function(){var a=new Function;return a}]),Bebella.factory("Recipe",[function(){var a=function(){this.tags=new Array,this.steps=new Array,this.products=new Array,this.comments=new Array,this.related=new Array};return a}]),Bebella.factory("User",[function(){var a=new Function;return a}]),Bebella.service("AuthUser",["$q","$localStorage",function(a,b){var c=this;c.get=function(){var c=a.defer(),d=b.auth_user;return d?c.resolve(d):c.reject("Usuário não salvo"),c.promise},c.set=function(a){b.auth_user=a},c.destroy=function(){b.$reset()}}]),Bebella.service("FilterOptions",["$q","$localStorage",function(a,b){var c=this;c.get=function(){var c=a.defer(),d=b.filter_options;return d?c.resolve(d):c.reject("Opções de filtro não salvas"),c.promise},c.set=function(a){b.filter_options=a},c.setDefault=function(){b.filter_options={beauty:!0,decoration:!0,clothing:!0}}}]),Bebella.service("PingProvider",["$q","$http",function(a,b){var c=this;c.ping=function(){var c=a.defer();return b.get(APP_URL+"/ping").then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise}}]),Bebella.service("ChannelRepository",["$http","$q","Channel","AuthUser",function(a,b,c,d){var e=this;e.find=function(e){var f=b.defer();return d.get().then(function(b){a.get(api_v1("channel/find/"+e,b.api_token)).then(function(a){var b=new c;attr(b,a.data),f.resolve(b)},function(a){f.reject(a)})},function(a){console.log(a)}),f.promise},e.all=function(){var e=b.defer();return d.get().then(function(b){a.get(api_v1("channel/all",b.api_token)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.edit=function(c){var e=b.defer();return d.get().then(function(b){var d=JSON.stringify(c);a.post(api_v1("channel/edit",b.api_token),d).then(function(a){e.resolve(c)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.save=function(c){var e=b.defer();return d.get().then(function(b){var d=JSON.stringify(c);a.post(api_v1("channel/save",b.api_token),d).then(function(a){c.id=a.data.id,e.resolve(c)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise}}]),Bebella.service("ProductRepository",["$http","$q","Product","AuthUser",function(a,b,c,d){var e=this;e.find=function(e){var f=b.defer();return d.get().then(function(b){a.get(api_v1("product/find/"+e,b.api_token)).then(function(a){var b=new c;attr(b,a.data),f.resolve(b)},function(a){f.reject(a)})},function(a){console.log(a)}),f.promise},e.all=function(){var e=b.defer();return d.get().then(function(b){a.get(api_v1("product/all",b.api_token)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.edit=function(c){var e=b.defer();return d.get().then(function(b){var d=JSON.stringify(c);a.post(api_v1("product/edit",b.api_token),d).then(function(a){e.resolve(c)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.save=function(c){var e=b.defer();return d.get().then(function(b){var d=JSON.stringify(c);a.post(api_v1("product/save",b.api_token),d).then(function(a){c.id=a.data.id,e.resolve(c)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise}}]),Bebella.service("ProductOptionRepository",["$http","$q","ProductOption","AuthUser",function(a,b,c,d){var e=this;e.find=function(e){var f=b.defer();return d.get().then(function(b){a.get(api_v1("product_option/find/"+e,b.api_token)).then(function(a){var b=new c;attr(b,a.data),f.resolve(b)},function(a){f.reject(a)})},function(a){console.log(a)}),f.promise},e.getStoreUrl=function(c){var e=b.defer();return d.get().then(function(b){a.get(api_v1("product_option/getStoreUrl/"+c,b.api_token)).then(function(a){e.resolve(a.data)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.all=function(){var e=b.defer();return d.get().then(function(b){a.get(api_v1("product_option/all",b.api_token)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.byProduct=function(e){var f=b.defer();return d.get().then(function(b){a.get(api_v1("product_option/byProduct/"+e,b.api_token)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});f.resolve(b)},function(a){f.reject(a)})},function(a){console.log(a)}),f.promise},e.edit=function(c){var e=b.defer();return d.get().then(function(b){var d=JSON.stringify(c);a.post(api_v1("product_option/edit",b.api_token),d).then(function(a){e.resolve(c)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.save=function(c){var e=b.defer();return d.get().then(function(b){var d=JSON.stringify(c);a.post(api_v1("product_option/save",b.api_token),d).then(function(a){c.id=a.data.id,e.resolve(c)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise}}]),Bebella.service("RecipeRepository",["$http","$q","Recipe","AuthUser",function(a,b,c,d){var e=this;e.find=function(e){var f=b.defer();return d.get().then(function(b){a.get(api_v1("recipe/find/"+e,b.api_token)).then(function(a){var b=new c;attr(b,a.data),f.resolve(b)},function(a){f.reject(a)})},function(a){console.log(a)}),f.promise},e.paginateWithFilters=function(e,f){var g=b.defer(),h=JSON.stringify(f);return d.get().then(function(b){a.post(api_v1("recipe/paginateWithFilters/"+e,b.api_token),h).then(function(a){var b=_.map(a.data.data,function(a){var b=new c;return attr(b,a),b});g.resolve(b)},function(a){g.reject(a)})},function(a){console.log(a)}),g.promise},e.trendingWithFilters=function(e,f){var g=b.defer(),h=JSON.stringify(f);return d.get().then(function(b){a.post(api_v1("recipe/trendingWithFilters/"+e,b.api_token),h).then(function(a){var b=_.map(a.data.data,function(a){var b=new c;return attr(b,a),b});g.resolve(b)},function(a){g.reject(a)})},function(a){console.log(a)}),g.promise},e.all=function(){var e=b.defer();return d.get().then(function(b){a.get(api_v1("recipe/all",b.api_token)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.trending=function(){var e=b.defer();return d.get().then(function(b){a.get(api_v1("recipe/trending",b.api_token)).then(function(a){var b=_.map(a.data,function(a){var b=new c;return attr(b,a),b});e.resolve(b)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.edit=function(c){var e=b.defer();return d.get().then(function(b){var d=JSON.stringify(c);a.post(api_v1("recipe/edit",b.api_token),d).then(function(a){e.resolve(c)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise},e.save=function(c){var e=b.defer();return d.get().then(function(b){var d=JSON.stringify(c);a.post(api_v1("recipe/save",b.api_token),d).then(function(a){c.id=a.data.id,e.resolve(c)},function(a){e.reject(a)})},function(a){console.log(a)}),e.promise}}]),Bebella.service("UserRepository",["$http","$q","User",function(a,b,c){var d=this;d.auth=function(d){var e=b.defer();return a.get(APP_URL+"/auth/user").then(function(a){var b=new c;attr(b,a.data),e.resolve(b)},function(a){e.reject(a)}),e.promise},d.login=function(c){var d=b.defer(),e=JSON.stringify(c);return a.post(APP_URL+"/auth/api_login",e).then(function(a){attr(c,a.data),d.resolve(c)},function(a){d.reject(a)}),d.promise}}]),Bebella.controller("FilterIndexCtrl",["$scope","FilterOptions",function(a,b){b.get().then(function(b){a.options=b},function(a){alert("Erro ao obter os filtros do usuário.")})}]),Bebella.controller("IndexCtrl",["$scope","RecipeRepository","FilterOptions",function(a,b,c){a.appUrl=APP_URL,a.moreDataCanBeLoaded=!0;var d=1;a.refresh=function(){a.moreDataCanBeLoaded=!0,c.get().then(function(c){d=1,b.paginateWithFilters(d,c).then(function(b){a.recipes=b,a.$broadcast("scroll.refreshComplete")},function(a){alert("Não foi possível obter o feed.")})},function(a){alert("Erro ao obter os filtros do usuário")})},a.nextPage=function(){d+=1,c.get().then(function(c){b.paginateWithFilters(d,c).then(function(b){0==b.length?a.moreDataCanBeLoaded=!1:a.recipes.push.apply(a.recipes,b),a.$broadcast("scroll.infiniteScrollComplete")},function(){alert("Erro ao obter próxima página")})},function(a){alert("Erro ao obter os filtros do usuário")})},c.get().then(function(c){b.paginateWithFilters(d,c).then(function(b){a.recipes=b},function(a){alert("Não foi possível obter o feed.")})},function(a){alert("Falha ao obter os filtros")}),a.$on("$stateChangeSuccess",function(){a.nextPage()})}]),Bebella.controller("LoginIndexCtrl",["$scope","$http","$state","AuthUser","User","PingProvider","UserRepository",function(a,b,c,d,e,f,g){a.user=new e,a.login=function(){f.ping().then(function(b){g.login(a.user).then(function(a){d.set(a),c.go("tabs.home")},function(a){alert("Login falhou, por favor, verifique as credenciais fornecidas.")})},function(a){alert("Não foi possivel estabelecer comunicação com o servidor.")})}}]),Bebella.controller("ProductOptionListCtrl",["$scope","$stateParams","ProductOptionRepository","ProductRepository",function(a,b,c,d){a.appUrl=APP_URL,a.redirectToStore=function(a){c.getStoreUrl(a).then(function(a){window.open(a,"_blank","location=yes")},function(a){alert("Erro ao obter link para produto")})},d.find(b.productId).then(function(b){a.product=b},function(a){alert("Erro ao obter detalhes do produto")}),c.byProduct(b.productId).then(function(b){a.product_options=b},function(a){alert("Houve um erro na obtenção da lista de opções de produto")})}]),Bebella.controller("RecipeIndexCtrl",["$scope","$stateParams","RecipeRepository",function(a,b,c){a.appUrl=APP_URL,c.find(b.recipeId).then(function(b){a.recipe=b},function(a){alert("Erro ao obter os detalhes da receita")})}]),Bebella.controller("RegisterIndexCtrl",["$scope",function(a){}]),Bebella.controller("SideMenuCtrl",["$scope",function(a){}]),Bebella.controller("SubscriptionIndexCtrl",["$scope","ChannelRepository",function(a,b){a.appUrl=APP_URL,b.all().then(function(b){a.channels=b},function(a){alert("Houve um erro na obtenção da lista de canais")})}]),Bebella.controller("TabsCtrl",["$scope","$state",function(a,b){a.changeTab=function(a){b.go(a)}}]),Bebella.controller("TrendingIndexCtrl",["$scope","RecipeRepository","FilterOptions",function(a,b,c){a.appUrl=APP_URL,a.moreDataCanBeLoaded=!0;var d=1;a.refresh=function(){a.moreDataCanBeLoaded=!0,c.get().then(function(c){d=1,b.trendingWithFilters(d,c).then(function(b){a.trendingRecipes=b,a.$broadcast("scroll.refreshComplete")},function(a){alert("Não foi possível obter o feed.")})},function(a){alert("Erro ao obter os filtros do usuário")})},a.nextPage=function(){d+=1,c.get().then(function(c){b.paginateWithFilters(d,c).then(function(b){0==b.length?a.moreDataCanBeLoaded=!1:a.trendingRecipes.push.apply(a.trendingRecipes,b),a.$broadcast("scroll.infiniteScrollComplete")},function(){alert("Erro ao obter próxima página")})},function(a){alert("Erro ao obter os filtros do usuário")})},c.get().then(function(c){b.paginateWithFilters(d,c).then(function(b){a.trendingRecipes=b},function(a){alert("Não foi possível obter o feed.")})},function(a){alert("Falha ao obter os filtros")}),a.$on("$stateChangeSuccess",function(){a.nextPage()})}]),Bebella.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/tabs/home"),a.state("login",{url:"/login",templateUrl:view("login/index"),controller:"LoginIndexCtrl"}).state("register",{url:"/register",templateUrl:view("register/index"),controller:"RegisterIndexCtrl"}).state("tabs",{url:"/tabs",templateUrl:view("tabs"),controller:"TabsCtrl","abstract":!0}).state("tabs.home",{url:"/home",views:{tab1:{templateUrl:view("home/index"),controller:"IndexCtrl"}}}).state("tabs.trending",{url:"/trending",views:{tab2:{templateUrl:view("trending/index"),controller:"TrendingIndexCtrl"}}}).state("tabs.subscriptions",{url:"/subscriptions",views:{tab3:{templateUrl:view("subscription/index"),controller:"SubscriptionIndexCtrl"}}}).state("tabs.filter",{url:"/filter",views:{tab4:{templateUrl:view("filter/index"),controller:"FilterIndexCtrl"}}}).state("recipe",{url:"/recipe/{recipeId}",templateUrl:view("recipe/index"),controller:"RecipeIndexCtrl"}).state("product_option_list",{url:"/product/{productId}/options",templateUrl:view("product/option/list"),controller:"ProductOptionListCtrl"})}]);